var H=Object.defineProperty,X=Object.defineProperties;var Y=Object.getOwnPropertyDescriptors;var R=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var D=(n,t,r)=>t in n?H(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,y=(n,t)=>{for(var r in t||(t={}))Q.call(t,r)&&D(n,r,t[r]);if(R)for(var r of R(t))z.call(t,r)&&D(n,r,t[r]);return n},v=(n,t)=>X(n,Y(t));import{Q as G,j as e,a as U,T as V,O as q,b as C,c as a,L as w,B as K,d as J,e as Z,f as _,r as c,u as ee,g as te,h as ne,i as re,k as ie,l as oe,R as se,m as b,n as ae}from"./vendor.f8a4c571.js";const le=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))d(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&d(l)}).observe(document,{childList:!0,subtree:!0});function r(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerpolicy&&(o.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?o.credentials="include":s.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function d(s){if(s.ep)return;s.ep=!0;const o=r(s);fetch(s.href,o)}};le();const de={fonts:{body:'"Segoe UI", Roboto, "Helvetica Neue", sans-serif',heading:'"Segoe UI", Roboto, "Helvetica Neue", sans-serif',monospace:"Menlo, monospace"},fontSizes:[12,14,16,20,24,32,48,64],fontWeights:{body:400,heading:700},colors:{text:"#000",background:"#fff",primary:"#33e",muted:"#ddd"},breakpoints:["40em","@media (min-width: 56em) and (orientation: landscape)"],styles:{root:{fontFamily:"body",fontSize:1,fontWeight:"body",lineHeight:"1.2"},a:{color:"primary"}}},ce=new G;function ue(){return e(C,{theme:de,children:e(U,{client:ce,children:e(V.root,{sx:{maxWidth:[380,720],marginX:"auto",paddingX:3},children:e(q,{})})})})}function he({icon:n,title:t,text:r}){return a("div",{sx:{display:"grid",gridTemplateAreas:`
          'icon title actions'
          'icon desc  actions'`,gridTemplateColumns:"40px 1fr auto",alignItems:"center",borderRadius:8,background:"#fff",color:"#000",paddingY:2},children:[e("span",{sx:{gridArea:"icon",justifySelf:"center"},children:n}),e("span",{sx:{gridArea:"title",fontWeight:"bold"},children:t}),e("span",{sx:{gridArea:"desc"},children:r}),e("span",{sx:{gridArea:"actions",justifySelf:"center",writingMode:"vertical-lr"},children:"..."})]})}function T({to:n,children:t}){return e(w,{to:n,children:t})}const P={PadLock:K,LightbulbOn:J,LightbulbOff:Z,Thermometer:_};function me({date:n,entries:t}){return a("section",{children:[a("h2",{children:[n,":"]}),t.length===0?e("span",{children:"No events logged"}):e("div",{sx:{display:"grid",gridTemplateColumns:"auto auto auto 1fr",rowGap:1,columnGap:2},children:t.map(({timestamp:r,icon:d,device:s,description:o},l)=>{const u=d in P?P[d]:"i";return a("div",{sx:{display:"contents"},children:[e("span",{children:e(pe,{value:r})}),e("span",{children:e(u,{})}),e("span",{children:s}),e("span",{children:o})]},l)})})]},n)}function pe({value:n}){const t=new Intl.DateTimeFormat([],{dateStyle:"short",timeStyle:"short"});return e(c.exports.Fragment,{children:t.format(new Date(n))})}function fe(){const{deviceId:n}=ee(),{data:t}=te(["device",n],async({queryKey:r})=>await(await fetch(`/ivy//api/devices/${r[1]}`)).json());return e(C,{theme:{colors:{text:"#fff",background:"#000",primary:"#0cf"}},children:a("div",{sx:{background:"#000",color:"#fff"},children:[e(T,{to:"/devices",children:"Back"}),e("h1",{children:t==null?void 0:t.name}),a("div",{sx:{display:"grid",gridTemplateAreas:`
            'temp status'
            'temp unit'
            'desc desc'`,gridTemplateColumns:"min-content min-content",gridTemplateRows:"auto auto",marginX:"auto"},children:[e("span",{sx:{gridArea:"temp",justifySelf:"end",fontSize:7,fontWeight:"bold",lineHeight:"100%"},children:t==null?void 0:t.value}),e("span",{sx:{gridArea:"unit",alignSelf:"end"},children:t==null?void 0:t.unit}),a("span",{sx:{gridArea:"desc",fontSize:0,textAlign:"center"},children:["Actual ",t==null?void 0:t.valueDesc," in your unit"]}),e("span",{sx:{gridArea:"status",justifySelf:"end"},children:e(ge,{value:t==null?void 0:t.status})})]}),a("div",{sx:{display:"flex",flexDirection:"column"},children:[t==null?void 0:t.alerts.map(r=>e(he,{icon:e(ne,{}),title:r.title,text:r.text},r.title)),e("div",{children:"+ Add alert"})]}),a("div",{sx:{display:"grid",gridTemplateAreas:`
            'title select'
            'graph graph'`,alignItems:"center",gridTemplateRows:"auto 1fr"},children:[e("h2",{sx:{gridArea:"title"},children:"Temperature"}),a("select",{sx:{gridArea:"select",borderColor:"#fff",padding:1,borderRadius:16,backgroundColor:"#000",color:"#fff"},children:[e("option",{children:"Weekly"}),e("option",{children:"Monthly"}),e("option",{children:"Yearly"})]}),t&&e(xe,{alerts:t.alerts,points:t.history})]})]})})}function ge({value:n}){return e("span",{sx:{display:"block",width:8,height:8,borderRadius:"50%",backgroundColor:n==="ok"?"greenyellow":n===void 0?"gray":"red"}})}function xe({alerts:n,points:t}){const[r,d]=c.exports.useState(null),[s,o]=c.exports.useState(null),[l,u]=c.exports.useState(null),[h,p]=c.exports.useState(null),{styles:f,attributes:S}=re(s,l,{modifiers:[{name:"arrow",options:{element:h}}],placement:"auto-start"}),M=Math.min(...t.map(i=>Date.parse(i.timestamp))),I=Math.max(...t.map(i=>Date.parse(i.timestamp))),B=Math.min(...t.map(i=>i.value),...n.flatMap(({threshold:i})=>[i.min,i.max]))-5,F=Math.max(...t.map(i=>i.value),...n.flatMap(({threshold:i})=>[i.min,i.max]))+5,g=300,L=100;function A(i){return(Date.parse(i)-M)/(I-M)*g}function m(i){return 100-(i-B)/(F-B)*L}return a(c.exports.Fragment,{children:[e("svg",{sx:{gridArea:"graph",justifySelf:"stretch",alignSelf:"stretch"},viewBox:`0 0 ${g} ${L}`,preserveAspectRatio:"xMidYMid meet",onMouseMove:i=>{const{left:x,width:$,top:j,height:E}=i.target.getBoundingClientRect(),N=(i.clientX-x)/$*g;(i.clientY-j)/E*L;const O=t.map(k=>v(y({},k),{dX:Math.abs(A(k.timestamp)-N)})).sort((k,W)=>k.dX-W.dX)[0];d(O)},onMouseOut:()=>d(null),children:a(c.exports.Fragment,{children:[n.map(i=>a(c.exports.Fragment,{children:[e("line",{x1:"0",x2:g,y1:m(i.threshold.min),y2:m(i.threshold.min),sx:{stroke:"red",strokeDasharray:"1,1",strokeWidth:.4}}),e("line",{x1:"0",x2:g,y1:m(i.threshold.max),y2:m(i.threshold.max),sx:{stroke:"red",strokeDasharray:"1,1",strokeWidth:.4}})]})),e("path",{d:t.reduce((i,x)=>`${i?`${i} L`:"M"}${A(x.timestamp)},${m(x.value)}`,""),sx:{stroke:"primary",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"}}),r&&e("g",{transform:`translate(${A(r.timestamp)}, ${m(r.value)})`,children:e("circle",{ref:o,r:"2",sx:{pointerEvents:"none",fill:"#fff"}})},r.timestamp)]})}),r&&a("div",v(y({ref:u,style:f.popper},S.popper),{sx:{pointerEvents:"none",padding:2,borderRadius:8,background:"#fff",color:"#000"},children:[r.value,"\xB0C",e("div",{ref:p,style:f.arrow})]}))]})}function ye(){return a(c.exports.Fragment,{children:[e(T,{to:"..",children:"Back"}),e("ul",{children:e("li",{children:e(w,{to:"1",children:"Device 1"})})})]})}function ve(){return e(c.exports.Fragment,{children:a("nav",{children:[e(w,{to:"logs",children:"Logs"})," | ",e(w,{to:"devices",children:"Devices"})]})})}function be(){const{data:n,isLoading:t,fetchNextPage:r,hasNextPage:d}=ie("logs",async({pageParam:o=0})=>await(await fetch(`/ivy//api/logs?page=${o}`)).json(),{getNextPageParam:(o,l)=>o.hasNext?l.length:void 0}),s=n==null?void 0:n.pages.flatMap((o,l,u)=>{var f;const h=o.nodes[o.nodes.length-1],p=(f=u[l+1])==null?void 0:f.nodes[0];if(!h)return[];if(h.date===(p==null?void 0:p.date)){const[S]=u[l+1].nodes.splice(0,1);return v(y({},o),{nodes:[...o.nodes.slice(0,-1),v(y({},h),{entries:[...h.entries,...S.entries]})]})}return o});return a(c.exports.Fragment,{children:[e(T,{to:"..",children:"Back"}),e("h1",{children:"Log data of unit 1"}),e("input",{type:"search",placeholder:"Search...",sx:{padding:2,borderRadius:8,border:"none",background:"#eee",width:"100%"}}),e("label",{htmlFor:"filter",sx:{display:"block",marginTop:3,marginBottom:2},children:"Filter logged events"}),a("select",{id:"filter",sx:{padding:2,borderRadius:8,border:"none",background:"#eee",width:"100%",fontWeight:"bold"},children:[e("option",{children:"Show all"}),e("option",{children:"Show notifications"}),e("option",{children:"Show warnings"}),e("option",{children:"Show alerts"})]}),t&&e("div",{children:"Loading..."}),e("div",{sx:{display:"flex",flexDirection:"column",gap:2,marginY:2},children:s==null?void 0:s.flatMap(o=>o.nodes.map(({date:l,entries:u})=>e(me,{date:l,entries:u},l)))}),e("button",{onClick:()=>r(),disabled:!d,sx:{backgroundColor:"#000",color:"#fff",paddingX:4,paddingY:2,border:"none",width:"100%",":disabled":{backgroundColor:"muted",color:"#333"}},children:"Load more data"})]})}ke();function ke(){oe.exports.render(e(ae,{basename:"/ivy/",children:e(se,{children:a(b,{path:"/",element:e(ue,{}),children:[e(b,{index:!0,element:e(ve,{})}),e(b,{path:"logs",element:e(be,{})}),e(b,{path:"devices",element:e(ye,{})}),e(b,{path:"devices/:deviceId",element:e(fe,{})})]})})}),document.getElementById("root"))}
